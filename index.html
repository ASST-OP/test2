<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
        .copyButton {
            margin-left: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>繰り返し検知</h1>
    <label for="inputString">文字列を入力してください:</label>
    <input type="text" id="inputString">
    <button onclick="findAndDisplayRepeats()">表示</button>
    
    <div id="result"></div>

    <script>
        function findAndDisplayRepeats() {
            const inputString = document.getElementById('inputString').value;
            const resultDiv = document.getElementById('result');

            function escapeRegExp(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }

            function findRepeats(str) {
                const repeats = new Set();
                const length = str.length;

                for (let i = 0; i < length; i++) {
                    for (let j = i + 1; j <= length; j++) {
                        const substr = str.slice(i, j);
                        const escapedSubstr = substr.split('').map(char => escapeRegExp(char)).join('');
                        const regex = new RegExp(escapedSubstr, 'g');
                        const match = str.match(regex);
                        if (match && match.length > 1) {
                            repeats.add(substr);
                        }
                    }
                }

                const sortedRepeats = Array.from(repeats).sort((a, b) => b.length - a.length);
                const uniqueRepeats = sortedRepeats.filter((item, index, self) =>
                    !self.some((otherItem, otherIndex) => otherIndex !== index && otherItem.includes(item))
                );

                return uniqueRepeats;
            }

            const repeats = findRepeats(inputString);

            if (repeats.length > 0) {
                resultDiv.innerHTML = `<p>繰り返されている文字列:</p><ul>${repeats.map(r => `
                    <li>
                        <button class="copyButton" onclick="copyTextToClipboard('${r}')">${r}</button>
                    </li>`).join('')}</ul>`;
            } else {
                resultDiv.innerHTML = `<p>繰り返されている文字列は見つかりませんでした。</p>`;
            }
        }

        function copyTextToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('コピーしました: ' + text);
        }
    </script>
</body>
</html>
