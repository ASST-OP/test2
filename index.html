<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
        #copyButton {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>繰り返し検知</h1>
    <label for="inputString">文字列を入力してください:</label>
    <input type="text" id="inputString">
    <button onclick="findAndDisplayRepeats()">表示</button>
    
    <div id="result"></div>
    <button id="copyButton" style="display:none;" onclick="copyToClipboard()">コピー</button>

    <script>
        function findAndDisplayRepeats() {
            const inputString = document.getElementById('inputString').value;
            const resultDiv = document.getElementById('result');
            const copyButton = document.getElementById('copyButton');

            function escapeRegExp(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }

            function findRepeats(str) {
                const repeats = new Set();
                const length = str.length;

                for (let i = 0; i < length; i++) {
                    for (let j = i + 1; j <= length; j++) {
                        const substr = str.slice(i, j);
                        const escapedSubstr = substr.split('').map(char => escapeRegExp(char)).join('');
                        const regex = new RegExp(escapedSubstr, 'g');
                        const match = str.match(regex);
                        if (match && match.length > 1) {
                            repeats.add(substr);
                        }
                    }
                }

                return Array.from(repeats).sort((a, b) => b.length - a.length);
            }

            const repeats = findRepeats(inputString);

            if (repeats.length > 0) {
                resultDiv.innerHTML = `<p>繰り返されている文字列:</p><ul>${repeats.map(r => `<li>${r}</li>`).join('')}</ul>`;
                copyButton.style.display = 'inline';
            } else {
                resultDiv.innerHTML = `<p>繰り返されている文字列は見つかりませんでした。</p>`;
                copyButton.style.display = 'none';
            }
        }

        function copyToClipboard() {
            const resultDiv = document.getElementById('result');
            const text = resultDiv.innerText;

            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            alert('コピーしました');
        }
    </script>
</body>
</html>
